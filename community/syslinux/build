#!/bin/sh -e

for patch in *.patch; do
    patch -p1 -i "$patch"
done

# Fix missing <sys/sysmacros.h> include.
sed -i 's@vfs.h>@vfs.h>\n#include <sys/sysmacros.h>@' extlinux/main.c

make efi64 installer
make -j1 \
    INSTALLROOT="$1" \
    MANDIR=/usr/share/man \
    SBINDIR=/usr/bin \
    AUXDIR=/usr/lib/syslinux \
    bios efi64 install
